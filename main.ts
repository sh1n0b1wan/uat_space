namespace SpriteKind {
    export const Scenery = SpriteKind.create()
}
function gravity () {
    rocket.ay += 50
}
controller.B.onEvent(ControllerButtonEvent.Pressed, function () {
    if (rocket.vy <= 50 && rocket.vy >= -50) {
        stage_count = 1
        music.stopAllSounds()
        _module = sprites.create(img`
            ........1........
            .......111.......
            ......11111......
            .....1919191.....
            ....121212121....
            ....121212121....
            ....121212121....
            ....121212121....
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            `, SpriteKind.Player)
        _module.x = rocket.x
        _module.y = rocket.y
        scene.cameraFollowSprite(_module)
        animation.runImageAnimation(
        _module,
        [img`
            ........1........
            .......111.......
            ......11111......
            .....1919191.....
            ....121212121....
            ....121212121....
            ....121212121....
            ....121212121....
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            `,img`
            ........8........
            ........1........
            .......111.......
            ......11111......
            .....1919191.....
            ....121212121....
            ....121212121....
            ....121212121....
            ....121212121....
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            `,img`
            .......868.......
            ........8........
            ........1........
            .......111.......
            ......11111......
            .....1919191.....
            ....121212121....
            ....121212121....
            ....121212121....
            ....121212121....
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            `,img`
            ......86868......
            .......868.......
            ........8........
            ........1........
            .......111.......
            ......11111......
            .....1919191.....
            ....121212121....
            ....121212121....
            ....121212121....
            ....121212121....
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            `,img`
            .....8668668.....
            ......86868......
            .......888.......
            ........8........
            ........1........
            .......111.......
            ......11111......
            .....1919191.....
            ....121212121....
            ....121212121....
            ....121212121....
            ....121212121....
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            `,img`
            ....866686668....
            .....8668668.....
            ......8.8.8......
            .......888.......
            ........8........
            ........1........
            .......111.......
            ......11111......
            .....1919191.....
            ....121212121....
            ....121212121....
            ....121212121....
            ....121212121....
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            `,img`
            ....666686666....
            ....866686668....
            .....86.8.68.....
            ......8.8.8......
            .......888.......
            ........8........
            ........1........
            .......111.......
            ......11111......
            .....1919191.....
            ....121212121....
            ....121212121....
            ....121212121....
            ....121212121....
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            `,img`
            .....6668666.....
            ....666686666....
            ....866686668....
            .....86.8.68.....
            ......8.8.8......
            .......888.......
            ........8........
            ........1........
            .......111.......
            ......11111......
            .....1919191.....
            ....121212121....
            ....121212121....
            ....121212121....
            ....121212121....
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            `,img`
            ......66866......
            .....6668666.....
            ....666686666....
            ....86..8..68....
            .....8..8..8.....
            ......8.8.8......
            .......888.......
            ........8........
            ........1........
            .......111.......
            ......11111......
            .....1919191.....
            ....121212121....
            ....121212121....
            ....121212121....
            ....121212121....
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            `,img`
            .....6668666.....
            ....666686666....
            ...66666866666...
            ...86666866668...
            ....86..8..68....
            .....8..8..8.....
            ......8.8.8......
            .......888.......
            ........8........
            ........1........
            .......111.......
            ......11111......
            .....1919191.....
            ....121212121....
            ....121212121....
            ....121212121....
            ....121212121....
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            `,img`
            ....666686666....
            ...66666866666...
            ..6666668666666..
            ..8666668666668..
            ...86...8...68...
            ....8...8...8....
            .....8..8..8.....
            ......8.8.8......
            .......888.......
            ........8........
            ........1........
            .......111.......
            ......11111......
            .....1919191.....
            ....121212121....
            ....121212121....
            ....121212121....
            ....121212121....
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            `,img`
            ....666686666....
            ...66666866666...
            ...66666866666...
            ..6666668666666..
            ..86...686...68..
            ...8....8....8...
            ....8...8...8....
            .....8..8..8.....
            ......8.8.8......
            .......888.......
            ........8........
            ........1........
            .......111.......
            ......11111......
            .....1919191.....
            ....121212121....
            ....121212121....
            ....121212121....
            ....121212121....
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            `,img`
            .....6668666.....
            ....666686666....
            ...66666866666...
            ...66666866666...
            ..6666668666666..
            ..86...686...68..
            ...8....8....8...
            ....8...8...8....
            .....8..8..8.....
            ......8.8.8......
            .......888.......
            ........8........
            ........1........
            .......111.......
            ......11111......
            .....1919191.....
            ....121212121....
            ....121212121....
            ....121212121....
            ....121212121....
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            `,img`
            ......66866......
            .....6668666.....
            ....666686666....
            ...66666866666...
            ...66666866666...
            ..6666668666666..
            ..86...686...68..
            ...8....8....8...
            ....8...8...8....
            .....8..8..8.....
            ......8.8.8......
            .......888.......
            ........8........
            ........1........
            .......111.......
            ......11111......
            .....1919191.....
            ....121212121....
            ....121212121....
            ....121212121....
            ....121212121....
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            `,img`
            ......66866......
            .....6668666.....
            ....666686666....
            ...66666866666...
            ...66666866666...
            ..6666668666666..
            ..86...686...68..
            ...8....8....8...
            ....8...8...8....
            .....8..8..8.....
            ......8.8.8......
            .......888.......
            ........8........
            ........1........
            .......111.......
            ......11111......
            .....1919191.....
            ....121212121....
            ....121212121....
            ....121212121....
            ....121212121....
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            `],
        100,
        false
        )
        refuse = sprites.create(img`
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            .................
            ....211111112....
            ....21b111b12....
            ....21b111b12....
            ....21b111b12....
            ....21bbbbb12....
            ....211111112....
            ....2111b1112....
            ....211b1b112....
            ....21b111b12....
            ....21bbbbb12....
            ....21b111b12....
            ....211111112....
            ....21bbbbb12....
            ....2111b1112....
            ....2111b1112....
            ....2111b1112....
            ...22111b11122...
            ...21121112112...
            ...21121112112...
            ...21121112112...
            ...2f1211121f2...
            ...2.f2fff2f.2...
            ......2...2......
            .................
            `, SpriteKind.Player)
        refuse.y = rocket.y
        refuse.x = rocket.x
        rocket.destroy()
        refuse.setVelocity(0, 0)
        refuse.ay = 50
        _module.setVelocity(0, 0)
        _module.ay = 20
        rocket.destroy()
        pause(2000)
        _module.ay = 0
    } else {
        rocket.destroy(effects.fire, 500)
        game.showLongText("Your velocity was too great for staging. The result is catastrophic. Press \"A\" to try again.", DialogLayout.Center)
    }
})
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    animation.runImageAnimation(
    rocket,
    [img`
        ........1........
        .......111.......
        ......11111......
        .....1919191.....
        ....121212121....
        ....121212121....
        ....121212121....
        ....121212121....
        ....211111112....
        ....21b111b12....
        ....21b111b12....
        ....21b111b12....
        ....21bbbbb12....
        ....211111112....
        ....2111b1112....
        ....211b1b112....
        ....21b111b12....
        ....21bbbbb12....
        ....21b111b12....
        ....211111112....
        ....21bbbbb12....
        ....2111b1112....
        ....2111b1112....
        ....2111b1112....
        ...22111b11122...
        ...21121112112...
        ...21121112112...
        ...21121112112...
        ...2f1211121f2...
        ...2.f2fff2f.2...
        .....5242425.....
        .....5442445.....
        .....5544455.....
        ......55455......
        .......555.......
        ......5.5........
        ...........5.....
        .......5.........
        .................
        `,img`
        ........1........
        .......111.......
        ......11111......
        .....1919191.....
        ....121212121....
        ....121212121....
        ....121212121....
        ....121212121....
        ....211111112....
        ....21b111b12....
        ....21b111b12....
        ....21b111b12....
        ....21bbbbb12....
        ....211111112....
        ....2111b1112....
        ....211b1b112....
        ....21b111b12....
        ....21bbbbb12....
        ....21b111b12....
        ....211111112....
        ....21bbbbb12....
        ....2111b1112....
        ....2111b1112....
        ....2111b1112....
        ...22111b11122...
        ...21121112112...
        ...21121112112...
        ...21121112112...
        ...2f1211121f2...
        ...2.f2fff2f.2...
        .....5242425.....
        .....5444445.....
        .....5544455.....
        ......45254......
        .......555.......
        ........5.5......
        .................
        ........5........
        ......5...5......
        `,img`
        ........1........
        .......111.......
        ......11111......
        .....1919191.....
        ....121212121....
        ....121212121....
        ....121212121....
        ....121212121....
        ....211111112....
        ....21b111b12....
        ....21b111b12....
        ....21b111b12....
        ....21bbbbb12....
        ....211111112....
        ....2111b1112....
        ....211b1b112....
        ....21b111b12....
        ....21bbbbb12....
        ....21b111b12....
        ....211111112....
        ....21bbbbb12....
        ....2111b1112....
        ....2111b1112....
        ....2111b1112....
        ...22111b11122...
        ...21121112112...
        ...21121112112...
        ...21121112112...
        ...2f1211121f2...
        ...2.f2fff2f.2...
        .....5245425.....
        .....5452545.....
        .....5544455.....
        ......55455......
        .....54555.5.....
        ........2.4......
        .......5.........
        .........5.......
        ......5..........
        `,img`
        ........1........
        .......111.......
        ......11111......
        .....1919191.....
        ....121212121....
        ....121212121....
        ....121212121....
        ....121212121....
        ....211111112....
        ....21b111b12....
        ....21b111b12....
        ....21b111b12....
        ....21bbbbb12....
        ....211111112....
        ....2111b1112....
        ....211b1b112....
        ....21b111b12....
        ....21bbbbb12....
        ....21b111b12....
        ....211111112....
        ....21bbbbb12....
        ....2111b1112....
        ....2111b1112....
        ....2111b1112....
        ...22111b11122...
        ...21121112112...
        ...21121112112...
        ...21121112112...
        ...2f1211121f2...
        ...2.f2fff2f.2...
        .....5244425.....
        .....5452445.....
        .....5542455.....
        ......55454......
        .......45555.....
        ........55.......
        ......5..5.5.....
        .................
        ........5........
        `],
    100,
    true
    )
})
controller.A.onEvent(ControllerButtonEvent.Released, function () {
    animation.stopAnimation(animation.AnimationTypes.All, rocket)
    rocket.setImage(img`
        ........1........
        .......111.......
        ......11111......
        .....1919191.....
        ....121212121....
        ....121212121....
        ....121212121....
        ....121212121....
        ....211111112....
        ....21b111b12....
        ....21b111b12....
        ....21b111b12....
        ....21bbbbb12....
        ....211111112....
        ....2111b1112....
        ....211b1b112....
        ....21b111b12....
        ....21bbbbb12....
        ....21b111b12....
        ....211111112....
        ....21bbbbb12....
        ....2111b1112....
        ....2111b1112....
        ....2111b1112....
        ...22111b11122...
        ...21121112112...
        ...21121112112...
        ...21121112112...
        ...2f1211121f2...
        ...2.f2fff2f.2...
        ......2...2......
        .................
        `)
    gravity()
})
controller.A.onEvent(ControllerButtonEvent.Repeated, function () {
    rocket.vy += -5
})
let refuse: Sprite = null
let _module: Sprite = null
let rocket: Sprite = null
let stage_count = 0
stage_count = 0
tiles.setTilemap(tilemap`level`)
let bracer = sprites.create(img`
    .................
    .................
    .................
    .................
    .................
    .................
    .................
    .................
    bbbb.............
    bd.d.............
    b.d..............
    bd.d.............
    bbbb.............
    bdb..............
    bdb..............
    bdb..............
    bbbb.............
    bdb..............
    bdb..............
    bdb..............
    bbbb.............
    bdb..............
    bdb..............
    bdb..............
    bbbb.............
    bdb..............
    bdb..............
    bdb..............
    bbb..............
    bdb..............
    bdb..............
    bdb..............
    `, SpriteKind.Scenery)
rocket = sprites.create(img`
    ........1........
    .......111.......
    ......11111......
    .....1919191.....
    ....121212121....
    ....121212121....
    ....121212121....
    ....121212121....
    ....211111112....
    ....21b111b12....
    ....21b111b12....
    ....21b111b12....
    ....21bbbbb12....
    ....211111112....
    ....2111b1112....
    ....211b1b112....
    ....21b111b12....
    ....21bbbbb12....
    ....21b111b12....
    ....211111112....
    ....21bbbbb12....
    ....2111b1112....
    ....2111b1112....
    ....2111b1112....
    ...22111b11122...
    ...21121112112...
    ...21121112112...
    ...21121112112...
    ...2f1211121f2...
    ...2.f2fff2f.2...
    ......2...2......
    .................
    `, SpriteKind.Player)
scene.cameraFollowSprite(rocket)
tiles.placeOnTile(rocket, tiles.getTileLocation(8, 247))
tiles.placeOnTile(bracer, tiles.getTileLocation(8, 247))
rocket.setVelocity(0, 0)
forever(function () {
    if (stage_count == 0) {
        info.player3.setScore(rocket.vy)
        info.player4.setScore(rocket.y + -3960)
    } else if (stage_count == 1) {
        info.player3.setScore(_module.vy)
        info.player4.setScore(_module.y + -3960)
        controller.moveSprite(_module, 20, 0)
    }
    if (rocket.isHittingTile(CollisionDirection.Bottom)) {
        rocket.destroy(effects.disintegrate, 500)
        pause(1500)
        game.showLongText("\"You have crashed. Press \"A\" to try again.", DialogLayout.Full)
        game.reset()
    }
})
forever(function () {
    if (stage_count == 1) {
        if (_module.isHittingTile(CollisionDirection.Bottom)) {
            game.over(true, effects.confetti)
        } else {
            if (_module.tileKindAt(TileDirection.Bottom, myTiles.tile7) || _module.tileKindAt(TileDirection.Bottom, myTiles.tile8)) {
                pause(100)
                info.changeScoreBy(500)
                pause(100)
                game.over(true, effects.confetti)
            }
        }
    }
    if (stage_count == 1) {
        if (refuse.isHittingTile(CollisionDirection.Bottom)) {
            refuse.destroy()
        }
    }
})
forever(function () {
    if (info.player4.score() < -3000) {
        game.showLongText("\"You have exceeded the maximum altitude for this mission. The module is lost forever. Press \"A\" to try again.", DialogLayout.Full)
        game.reset()
    }
})
forever(function () {
    if (stage_count == 0) {
        if (info.player4.score() < -500 && info.player4.score() >= -1000) {
            info.setScore(100)
        } else if (info.player4.score() < -1001 && info.player4.score() >= -1500) {
            info.setScore(200)
        } else if (info.player4.score() < -1501 && info.player4.score() >= -2000) {
            info.setScore(300)
        } else if (info.player4.score() < -2001 && info.player4.score() >= -2500) {
            info.setScore(400)
        } else if (info.player4.score() < -2501) {
            info.setScore(500)
        }
    }
})
